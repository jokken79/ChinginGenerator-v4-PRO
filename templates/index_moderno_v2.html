<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë≥ÉÈáëÂè∞Â∏≥ Generator v4.1 PRO - Modern UI Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* Light Theme */
        body.light-theme {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            min-height: 100vh;
            color: #1a202c;
        }
        
        .light-theme .glass-morphism {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #1a202c;
        }
        
        .light-theme .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.8);
            color: #1a202c;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        /* Dark Theme */
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #f7fafc;
        }
        
        .dark-theme .glass-morphism {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #f7fafc;
        }
        
        .dark-theme .stat-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.7));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            color: #f7fafc;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hover-scale {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .tab-active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .progress-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .terminal {
            background: #0a0a0a;
            color: #0f0;
            font-family: 'Fira Code', 'Consolas', monospace;
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .gradient-border {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8, #06b6d4, #10b981);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .neon-text {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.8),
                         0 0 20px rgba(59, 130, 246, 0.6),
                         0 0 30px rgba(59, 130, 246, 0.4);
        }
        
        .agent-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .dark-theme .agent-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(16, 185, 129, 0.2));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .settings-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.4);
            color: #1a202c;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .dark-theme .settings-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255,255,255,0.2);
            color: #f7fafc;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        /* Enhanced text visibility */
        .text-primary {
            color: #1a202c !important;
        }
        
        .dark-theme .text-primary {
            color: #f7fafc !important;
        }
        
        .text-secondary {
            color: #4a5568 !important;
        }
        
        .dark-theme .text-secondary {
            color: #cbd5e0 !important;
        }
        
        .text-muted {
            color: #718096 !important;
        }
        
        .dark-theme .text-muted {
            color: #a0aec0 !important;
        }
        
        /* Enhanced button visibility */
        .btn-glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #1a202c;
            transition: all 0.3s ease;
        }
        
        .btn-glass:hover {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .dark-theme .btn-glass {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #f7fafc;
        }
        
        .dark-theme .btn-glass:hover {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        /* Fix para select/option - texto visible en dropdown */
        select option {
            background-color: #ffffff;
            color: #1a202c;
            padding: 12px;
        }

        select option:hover,
        select option:focus,
        select option:checked {
            background-color: #3b82f6;
            color: #ffffff;
        }

        .dark-theme select option {
            background-color: #1a1a2e;
            color: #f7fafc;
        }

        .dark-theme select option:hover,
        .dark-theme select option:focus,
        .dark-theme select option:checked {
            background-color: #3b82f6;
            color: #ffffff;
        }

        /* Mejorar visibilidad de textos en glassmorphism */
        .glass-morphism p[class*="text-white"],
        section p[class*="text-white"] {
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        /* Select fields con mejor legibilidad */
        select {
            color: #1a202c !important;
            background-color: rgba(255, 255, 255, 0.9) !important;
        }

        .dark-theme select {
            color: #f7fafc !important;
            background-color: rgba(0, 0, 0, 0.6) !important;
        }
    </style>
</head>
<body class="min-h-screen light-theme">
    <!-- Animated Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute w-96 h-96 bg-blue-500 rounded-full opacity-10 blur-3xl -top-48 -left-48 floating"></div>
        <div class="absolute w-96 h-96 bg-cyan-500 rounded-full opacity-10 blur-3xl -bottom-48 -right-48 floating" style="animation-delay: 1s;"></div>
        <div class="absolute w-64 h-64 bg-teal-500 rounded-full opacity-10 blur-2xl top-1/2 left-1/2 floating" style="animation-delay: 2s;"></div>
    </div>

    <!-- Header -->
    <header class="glass-morphism sticky top-0 z-50 border-b border-white/30 shadow-lg">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 gradient-border rounded-xl flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-primary">Ë≥ÉÈáëÂè∞Â∏≥ Generator</h1>
                        <p class="text-secondary text-sm">v4.1 PRO - Enhanced Modern UI</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="btn-glass px-4 py-2 rounded-full">
                        <span class="text-primary text-sm flex items-center gap-2">
                            <i class="fas fa-database text-green-500"></i>
                            BD Conectada
                        </span>
                    </div>
                    <div class="btn-glass px-4 py-2 rounded-full">
                        <span id="recordCount" class="text-primary text-sm font-medium">0 registros</span>
                    </div>
                    <button onclick="toggleThemeSelector()" class="btn-glass px-4 py-2 rounded-full text-primary hover:bg-white/20 transition-all">
                        <i class="fas fa-palette"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Stats Dashboard -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stat-card rounded-2xl p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-users text-blue-600 text-xl"></i>
                    </div>
                    <div class="text-blue-600 text-sm font-medium">+12%</div>
                </div>
                <p class="text-secondary text-sm mb-1 font-medium">Empleados</p>
                <p id="statEmployees" class="text-3xl font-bold text-primary">0</p>
                <div class="mt-3 h-1 bg-blue-500/30 rounded-full overflow-hidden">
                    <div class="h-full bg-blue-500 rounded-full" style="width: 75%;"></div>
                </div>
            </div>

            <div class="stat-card rounded-2xl p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-file-alt text-green-600 text-xl"></i>
                    </div>
                    <div class="text-green-600 text-sm font-medium">+8%</div>
                </div>
                <p class="text-secondary text-sm mb-1 font-medium">Registros</p>
                <p id="statRecords" class="text-3xl font-bold text-primary">0</p>
                <div class="mt-3 h-1 bg-green-500/30 rounded-full overflow-hidden">
                    <div class="h-full bg-green-500 rounded-full" style="width: 82%;"></div>
                </div>
            </div>

            <div class="stat-card rounded-2xl p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-cyan-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-calendar text-cyan-600 text-xl"></i>
                    </div>
                    <div class="text-cyan-600 text-sm font-medium">+15%</div>
                </div>
                <p class="text-secondary text-sm mb-1 font-medium">Periodos</p>
                <p id="statPeriods" class="text-3xl font-bold text-primary">0</p>
                <div class="mt-3 h-1 bg-cyan-500/30 rounded-full overflow-hidden">
                    <div class="h-full bg-cyan-500 rounded-full" style="width: 68%;"></div>
                </div>
            </div>

            <div class="stat-card rounded-2xl p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-orange-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-yen-sign text-orange-600 text-xl"></i>
                    </div>
                    <div class="text-orange-600 text-sm font-medium">+5%</div>
                </div>
                <p class="text-secondary text-sm mb-1 font-medium">Total Neto</p>
                <p id="statNetPay" class="text-3xl font-bold text-primary">¬•0</p>
                <div class="mt-3 h-1 bg-orange-500/30 rounded-full overflow-hidden">
                    <div class="h-full bg-orange-500 rounded-full" style="width: 91%;"></div>
                </div>
            </div>
        </section>

        <!-- Navigation Tabs -->
        <nav class="glass-morphism rounded-2xl p-2 mb-8 shadow-xl">
            <div class="flex flex-wrap gap-2">
                <button onclick="showTab('upload')" id="tab-upload" class="tab-active px-6 py-3 rounded-xl font-medium text-primary transition-all duration-300 flex items-center gap-2 hover:bg-white/20">
                    <i class="fas fa-cloud-upload-alt"></i>
                    Subir Archivos
                </button>
                <button onclick="showTab('data')" id="tab-data" class="px-6 py-3 rounded-xl font-medium text-secondary hover:text-primary hover:bg-white/10 transition-all duration-300 flex items-center gap-2">
                    <i class="fas fa-database"></i>
                    Datos
                </button>
                <button onclick="showTab('export')" id="tab-export" class="px-6 py-3 rounded-xl font-medium text-secondary hover:text-primary hover:bg-white/10 transition-all duration-300 flex items-center gap-2">
                    <i class="fas fa-download"></i>
                    Exportar
                </button>
                <button onclick="showTab('chingin')" id="tab-chingin" class="px-6 py-3 rounded-xl font-medium text-secondary hover:text-primary hover:bg-white/10 transition-all duration-300 flex items-center gap-2">
                    <i class="fas fa-file-invoice"></i>
                    Ë≥ÉÈáëÂè∞Â∏≥
                </button>
                <button onclick="showTab('agents')" id="tab-agents" class="px-6 py-3 rounded-xl font-medium text-secondary hover:text-primary hover:bg-white/10 transition-all duration-300 flex items-center gap-2">
                    <i class="fas fa-robot"></i>
                    Agentes IA
                </button>
                <button onclick="showTab('backup')" id="tab-backup" class="px-6 py-3 rounded-xl font-medium text-secondary hover:text-primary hover:bg-white/10 transition-all duration-300 flex items-center gap-2">
                    <i class="fas fa-shield-alt"></i>
                    Backup
                </button>
                <button onclick="showTab('audit')" id="tab-audit" class="px-6 py-3 rounded-xl font-medium text-secondary hover:text-primary hover:bg-white/10 transition-all duration-300 flex items-center gap-2">
                    <i class="fas fa-history"></i>
                    Auditor√≠a
                </button>
                <button onclick="showTab('settings')" id="tab-settings" class="px-6 py-3 rounded-xl font-medium text-secondary hover:text-primary hover:bg-white/10 transition-all duration-300 flex items-center gap-2">
                    <i class="fas fa-cog"></i>
                    Config
                </button>
            </div>
        </nav>

        <!-- Tab: Upload -->
        <section id="section-upload" class="tab-content">
            <div class="glass-morphism rounded-2xl p-8 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-primary flex items-center gap-3">
                        <i class="fas fa-cloud-upload-alt text-blue-500"></i>
                        Subir Archivos Âã§ÊÄ†Ë°®
                    </h2>
                    <button onclick="clearAllData()" class="bg-red-500/20 hover:bg-red-500/30 text-red-600 hover:text-red-500 px-6 py-3 rounded-xl font-medium transition-all duration-300 flex items-center gap-2">
                        <i class="fas fa-trash-alt"></i>
                        Borrar Todos los Datos
                    </button>
                </div>
                
                <div id="dropZone" class="border-3 border-dashed border-white/30 rounded-2xl p-12 text-center cursor-pointer hover:border-white/50 hover:bg-white/5 transition-all duration-300">
                    <div class="flex flex-col items-center gap-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl flex items-center justify-center floating">
                            <i class="fas fa-file-upload text-white text-3xl"></i>
                        </div>
                        <p class="text-primary text-xl font-medium">„Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó</p>
                        <p class="text-secondary">o haz clic para seleccionar</p>
                        <p class="text-muted text-sm mt-2">Formatos: .xlsm, .xlsx, .xls</p>
                    </div>
                    <input type="file" id="fileInput" multiple accept=".xlsm,.xlsx,.xls" class="hidden">
                </div>

                <!-- Progress Section -->
                <div id="progressSection" class="hidden">
                    <div class="glass-morphism rounded-2xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-primary font-medium text-lg" id="progressTitle">Procesando...</span>
                            <span class="text-secondary text-lg" id="progressPercent">0%</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-6 overflow-hidden">
                            <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-cyan-600 h-6 rounded-full transition-all duration-500 progress-glow" style="width: 0%"></div>
                        </div>
                        <div class="mt-4 text-white/70 text-sm" id="progressDetails">
                            <!-- Progress details -->
                        </div>
                        <div id="progressLog" class="mt-4 max-h-64 overflow-y-auto terminal rounded-xl p-4 border border-white/20 hidden">
                            <div class="text-green-400 mb-2">$ chingin-processor --upload --enhanced-ui</div>
                            <!-- Terminal log -->
                        </div>
                    </div>
                </div>

                <div id="fileList" class="mt-6 space-y-3 hidden">
                    <h3 class="text-primary text-lg font-medium mb-3 flex items-center gap-2">
                        <i class="fas fa-check-circle text-green-500"></i>
                        Archivos procesados:
                    </h3>
                    <div id="fileItems" class="space-y-2"></div>
                </div>
            </div>
        </section>

        <!-- Tab: Data -->
        <section id="section-data" class="tab-content hidden">
            <div class="glass-morphism rounded-2xl p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-primary flex items-center gap-3">
                        <i class="fas fa-database text-green-500"></i>
                        Datos de N√≥mina
                    </h2>
                    <div class="flex gap-3">
                        <button onclick="clearAllData()" class="bg-red-500/20 hover:bg-red-500/30 text-red-600 hover:text-red-500 px-6 py-3 rounded-xl font-medium transition-all duration-300 flex items-center gap-2">
                            <i class="fas fa-trash-alt"></i>
                            Borrar Todo
                        </button>
                        <button onclick="loadData()" class="bg-blue-500/20 hover:bg-blue-500/30 text-blue-600 hover:text-blue-500 px-6 py-3 rounded-xl font-medium transition-all duration-300 flex items-center gap-2">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <div class="glass-morphism rounded-xl overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-white/20">
                                <tr>
                                    <th class="px-6 py-4 text-left text-primary font-semibold">ÂæìÊ•≠Âì°Áï™Âè∑</th>
                                    <th class="px-6 py-4 text-left text-primary font-semibold">Ê∞èÂêç</th>
                                    <th class="px-6 py-4 text-left text-primary font-semibold">ÊîØÁµ¶ÂàÜ</th>
                                    <th class="px-6 py-4 text-right text-primary font-semibold">Á∑èÊîØÁµ¶È°ç</th>
                                    <th class="px-6 py-4 text-right text-primary font-semibold">ÊéßÈô§ÂêàË®à</th>
                                    <th class="px-6 py-4 text-right text-primary font-semibold">Â∑ÆÂºïÊîØÁµ¶È°ç</th>
                                </tr>
                            </thead>
                            <tbody id="dataTable" class="divide-y divide-white/10"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab: Export -->
        <section id="section-export" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-morphism rounded-2xl p-8 text-center hover-scale">
                    <div class="w-16 h-16 bg-green-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-file-excel text-green-400 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-3">ALLÂá∫Âäõ</h3>
                    <p class="text-secondary mb-6">Todos los datos consolidados</p>
                    <button onclick="exportAll()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-download"></i>
                        Descargar Excel
                    </button>
                </div>

                <div class="glass-morphism rounded-2xl p-8 text-center hover-scale">
                    <div class="w-16 h-16 bg-cyan-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-calendar-alt text-cyan-400 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-3">ÊúàÂà•ÂàÜÂâ≤</h3>
                    <p class="text-secondary mb-6">Hojas separadas por mes</p>
                    <button onclick="exportMonthly()" class="w-full bg-gradient-to-r from-cyan-500 to-teal-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-download"></i>
                        Descargar Excel
                    </button>
                </div>

                <div class="glass-morphism rounded-2xl p-8 text-center hover-scale">
                    <div class="w-16 h-16 bg-orange-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-file-invoice text-orange-400 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-3">Ë≥ÉÈáëÂè∞Â∏≥</h3>
                    <p class="text-secondary mb-6">Un archivo por empleado</p>
                    <button onclick="exportChingin()" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-file-archive"></i>
                        Descargar ZIP
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab: Chingin -->
        <section id="section-chingin" class="tab-content hidden">
            <div class="glass-morphism rounded-2xl p-8 mb-6">
                <h2 class="text-2xl font-bold text-primary mb-6 flex items-center gap-3">
                    <i class="fas fa-file-invoice text-orange-500"></i>
                    Ë≥ÉÈáëÂè∞Â∏≥ - Generar por Empleado o F√°brica
                </h2>
                
                <!-- Navegaci√≥n por F√°brica/Empresa -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Ê¥æÈÅ£Á§æÂì° - Por F√°brica -->
                    <div class="glass-morphism rounded-xl p-6 bg-blue-500/10">
                        <h3 class="text-xl font-bold text-cyan-400 mb-4 flex items-center gap-2">
                            <i class="fas fa-industry"></i>
                            üè≠ Ê¥æÈÅ£Á§æÂì° - Por F√°brica
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-primary font-medium mb-2 flex items-center gap-2">
                                    <i class="fas fa-building text-blue-400"></i>
                                    Ê¥æÈÅ£ÂÖà (F√°brica)
                                </label>
                                <select id="companySelect" onchange="loadCompanyEmployees()" title="Ê¥æÈÅ£ÂÖàÈÅ∏Êäû"
                                        class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                                    <option value="">-- ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ --</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-primary font-medium mb-2 flex items-center gap-2">
                                    <i class="fas fa-user text-blue-400"></i>
                                    ÂæìÊ•≠Âì° (Empleado) - Individual
                                </label>
                                <select id="companyEmployeeSelect" onchange="selectCompanyEmployee()" title="ÂæìÊ•≠Âì°ÈÅ∏Êäû"
                                        class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300" disabled>
                                    <option value="">-- ÂÖà„Å´Ê¥æÈÅ£ÂÖà„ÇíÈÅ∏Êäû --</option>
                                </select>
                            </div>
                            <div class="pt-4 border-t border-white/20">
                                <button onclick="generateAllByCompany()" id="btnGenerateAllCompany"
                                        class="w-full bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2 disabled:bg-gray-500 disabled:cursor-not-allowed"
                                        disabled>
                                    <i class="fas fa-file-archive"></i>
                                    üì¶ ÂÖ®Âì°„ÅÆË≥ÉÈáëÂè∞Â∏≥„ÇíÁîüÊàê (ZIP)
                                </button>
                                <p class="text-cyan-400 text-sm mt-2 text-center" id="companyEmployeeCount">--</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ë´ãË≤†Á§æÂì° - Â≤°Â±±Â∑•Â†¥ (Todos) -->
                    <div class="glass-morphism rounded-xl p-6 bg-green-500/10">
                        <h3 class="text-xl font-bold text-green-400 mb-4 flex items-center gap-2">
                            <i class="fas fa-hard-hat"></i>
                            üîß Ë´ãË≤†Á§æÂì° - Â≤°Â±±Â∑•Â†¥
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-primary font-medium mb-2 flex items-center gap-2">
                                    <i class="fas fa-users text-green-400"></i>
                                    ÂæìÊ•≠Âì° (Individual)
                                </label>
                                <select id="ukeoiEmployeeSelect" onchange="selectUkeoiEmployee()" title="Ë´ãË≤†ÂæìÊ•≠Âì°ÈÅ∏Êäû"
                                        class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300">
                                    <option value="">-- ÂæìÊ•≠Âì°„ÇíÈÅ∏Êäû --</option>
                                </select>
                            </div>
                            <div class="pt-4 border-t border-white/20">
                                <button onclick="generateAllUkeoi()" id="btnGenerateAllUkeoi"
                                        class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                                    <i class="fas fa-file-archive"></i>
                                    üì¶ Ë´ãË≤†Á§æÂì° ÂÖ®Âì°„ÅÆË≥ÉÈáëÂè∞Â∏≥„ÇíÁîüÊàê (ZIP)
                                </button>
                                <p class="text-green-400 text-sm mt-2 text-center" id="ukeoiEmployeeCount">--</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- B√∫squeda directa por ID -->
                <div class="glass-morphism rounded-xl p-6 border-t border-white/20">
                    <p class="text-secondary mb-4 flex items-center gap-2">
                        <i class="fas fa-search text-cyan-400"></i>
                        „Åæ„Åü„ÅØÂæìÊ•≠Âì°Áï™Âè∑„ÅßÁõ¥Êé•Ê§úÁ¥¢:
                    </p>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 items-end">
                        <div class="lg:col-span-1">
                            <label class="block text-primary font-medium mb-2 flex items-center gap-2">
                                <i class="fas fa-id-badge text-blue-400"></i>
                                ÂæìÊ•≠Âì°Áï™Âè∑ (ID)
                            </label>
                            <input type="text" id="employeeIdInput" placeholder="Ej: 504010"
                                   class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"
                                   onkeypress="if(event.key==='Enter') searchEmployee()">
                        </div>
                        <div>
                            <label class="block text-primary font-medium mb-2 flex items-center gap-2">
                                <i class="fas fa-calendar text-cyan-400"></i>
                                Âπ¥Â∫¶
                            </label>
                            <select id="yearSelect" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all duration-300">
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>
                        <button onclick="searchEmployee()" class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-3 px-6 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                            <i class="fas fa-search"></i>
                            üîç Ê§úÁ¥¢ Buscar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Employee Result -->
            <div id="employeeResult" class="hidden">
                <div class="glass-morphism rounded-2xl p-8 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-primary" id="empName">-</h3>
                            <p class="text-secondary" id="empId">-</p>
                        </div>
                        <div class="text-right">
                            <p class="text-secondary text-sm">Ê¥æÈÅ£ÂÖà</p>
                            <p class="text-primary font-medium" id="empDispatch">-</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="glass-morphism rounded-xl p-4">
                            <p class="text-secondary text-sm mb-2">ÁôªÈå≤Êï∞</p>
                            <p class="text-2xl font-bold text-blue-400" id="empRecords">0</p>
                        </div>
                        <div class="glass-morphism rounded-xl p-4">
                            <p class="text-secondary text-sm mb-2">ÂØæË±°ÊúüÈñì</p>
                            <p class="text-lg font-semibold text-green-400" id="empPeriods">-</p>
                        </div>
                        <div class="glass-morphism rounded-xl p-4">
                            <p class="text-secondary text-sm mb-2">Ê∞èÂêç</p>
                            <p class="text-sm font-semibold text-cyan-400" id="empKana">-</p>
                            <p class="text-sm font-semibold text-cyan-300" id="empRoman">-</p>
                        </div>
                    </div>

                    <!-- Selectores de Formato y Tipo de Salida -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-primary font-medium mb-2 flex items-center gap-2">
                                <i class="fas fa-file-alt text-blue-400"></i>
                                üìã Formato de Template
                            </label>
                            <select id="chinginFormat" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                                <option value="b">Formato B - Detallado (Ê®™ 12„É∂Êúà Ë©≥Á¥∞)</option>
                                <option value="c">Formato C - Simplificado (Ê®™ 12„É∂Êúà Á∞°Êòì)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-primary font-medium mb-2 flex items-center gap-2">
                                <i class="fas fa-file-export text-cyan-400"></i>
                                üìÑ Tipo de Salida
                            </label>
                            <select id="chinginOutputType" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all duration-300">
                                <option value="excel">Excel (.xlsx)</option>
                                <option value="pdf">PDF (.pdf)</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="generateChingin()" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                            <i class="fas fa-download"></i>
                            üì• Ë≥ÉÈáëÂè∞Â∏≥„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                        </button>
                        <button onclick="previewChingin()" class="flex-1 bg-gradient-to-r from-cyan-500 to-teal-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                            <i class="fas fa-eye"></i>
                            üëÅÔ∏è „Éó„É¨„Éì„É•„Éº Preview
                        </button>
                    </div>
                </div>

                <!-- Vista previa de datos -->
                <div id="previewSection" class="hidden">
                    <div class="glass-morphism rounded-2xl p-8">
                        <h3 class="text-xl font-bold text-primary mb-6 flex items-center gap-3">
                            <i class="fas fa-chart-bar text-cyan-400"></i>
                            üìä Vista Previa de Datos
                        </h3>
                        <div class="overflow-x-auto">
                            <div class="glass-morphism rounded-xl overflow-hidden">
                                <table class="w-full">
                                    <thead class="bg-white/20">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-primary font-semibold">Êúà</th>
                                            <th class="px-6 py-4 text-center text-primary font-semibold">Âá∫Âã§Êó•Êï∞</th>
                                            <th class="px-6 py-4 text-center text-primary font-semibold">ÂÆüÂÉçÊôÇÈñì</th>
                                            <th class="px-6 py-4 text-center text-primary font-semibold">ÊÆãÊ•≠ÊôÇÈñì</th>
                                            <th class="px-6 py-4 text-right text-primary font-semibold">Âü∫Êú¨Áµ¶</th>
                                            <th class="px-6 py-4 text-right text-primary font-semibold">ÊÆãÊ•≠ÊâãÂΩì</th>
                                            <th class="px-6 py-4 text-right text-primary font-semibold">Á∑èÊîØÁµ¶È°ç</th>
                                            <th class="px-6 py-4 text-right text-primary font-semibold">ÊéßÈô§ÂêàË®à</th>
                                            <th class="px-6 py-4 text-right text-primary font-bold">Â∑ÆÂºïÊîØÁµ¶È°ç</th>
                                        </tr>
                                    </thead>
                                    <tbody id="previewTable" class="divide-y divide-white/10"></tbody>
                                    <tfoot class="bg-white/10 font-bold">
                                        <tr>
                                            <td class="px-6 py-4 text-primary">ÂêàË®à</td>
                                            <td class="px-6 py-4 text-center text-primary" id="totalWorkDays">-</td>
                                            <td class="px-6 py-4 text-center text-primary" id="totalWorkHours">-</td>
                                            <td class="px-6 py-4 text-center text-primary" id="totalOvertimeHours">-</td>
                                            <td class="px-6 py-4 text-right text-primary" id="totalBasePay">-</td>
                                            <td class="px-6 py-4 text-right text-primary" id="totalOvertimePay">-</td>
                                            <td class="px-6 py-4 text-right text-primary" id="totalPay">-</td>
                                            <td class="px-6 py-4 text-right text-primary" id="totalDeduction">-</td>
                                            <td class="px-6 py-4 text-right text-green-400" id="totalNetPay">-</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Not Found -->
            <div id="employeeNotFound" class="hidden">
                <div class="glass-morphism rounded-2xl p-12 text-center">
                    <div class="w-20 h-20 bg-red-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-user-slash text-red-400 text-3xl"></i>
                    </div>
                    <p class="text-red-600 font-medium text-xl mb-2">ÂæìÊ•≠Âì°„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</p>
                    <p class="text-secondary">El empleado no fue encontrado en la base de datos</p>
                </div>
            </div>
        </section>

        <!-- Tab: Agents -->
        <section id="section-agents" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="agent-card rounded-2xl p-6 hover-scale">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-2">Payroll Analyzer</h3>
                    <p class="text-secondary mb-4">An√°lisis profundo de n√≥minas</p>
                    <button onclick="runAgent('payroll-analyzer')" class="w-full bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i>
                        Ejecutar An√°lisis
                    </button>
                </div>

                <div class="agent-card rounded-2xl p-6 hover-scale">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-search text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-2">Anomaly Detection</h3>
                    <p class="text-secondary mb-4">Detecci√≥n de anomal√≠as</p>
                    <button onclick="runAgent('anomaly-detection')" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i>
                        Detectar Anomal√≠as
                    </button>
                </div>

                <div class="agent-card rounded-2xl p-6 hover-scale">
                    <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-file-alt text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-2">Report Generator</h3>
                    <p class="text-secondary mb-4">Generaci√≥n de reportes</p>
                    <button onclick="runAgent('report-generator')" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i>
                        Generar Reporte
                    </button>
                </div>

                <div class="agent-card rounded-2xl p-6 hover-scale">
                    <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-bar text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-2">Trend Analysis</h3>
                    <p class="text-secondary mb-4">An√°lisis de tendencias</p>
                    <button onclick="runAgent('trend-analysis')" class="w-full bg-gradient-to-r from-cyan-500 to-teal-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i>
                        Analizar Tendencias
                    </button>
                </div>

                <div class="agent-card rounded-2xl p-6 hover-scale">
                    <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-shield-alt text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-2">Data Validation</h3>
                    <p class="text-secondary mb-4">Validaci√≥n de datos</p>
                    <button onclick="runAgent('data-validation')" class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i>
                        Validar Datos
                    </button>
                </div>

                <div class="agent-card rounded-2xl p-6 hover-scale">
                    <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-gavel text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-primary mb-2">Compliance Check</h3>
                    <p class="text-secondary mb-4">Verificaci√≥n de cumplimiento</p>
                    <button onclick="runAgent('compliance-check')" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i>
                        Verificar Cumplimiento
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab: Settings -->
        <section id="section-settings" class="tab-content hidden">
            <div class="settings-panel rounded-2xl p-8 max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-primary mb-6 flex items-center gap-3">
                    <i class="fas fa-cog text-cyan-600"></i>
                    Configuraci√≥n del Sistema
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Theme Settings -->
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold mb-4">Apariencia</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Tema de Color</label>
                                <div class="flex gap-3">
                                    <button onclick="setColorTheme('light')" id="btnLightTheme" class="flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-white border-2 border-gray-300 text-gray-800 hover:border-blue-500">
                                        <i class="fas fa-sun mr-2"></i>Claro
                                    </button>
                                    <button onclick="setColorTheme('dark')" id="btnDarkTheme" class="flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-800 border-2 border-gray-600 text-white hover:border-blue-400">
                                        <i class="fas fa-moon mr-2"></i>Oscuro
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Estilo de Interfaz</label>
                                <div class="flex gap-3">
                                    <button onclick="setInterfaceTheme('moderno')" id="btnModernUI" class="flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gradient-to-r from-blue-500 to-cyan-600 text-white">
                                        <i class="fas fa-rocket mr-2"></i>Moderno
                                    </button>
                                    <button onclick="setInterfaceTheme('clasico')" id="btnClassicUI" class="flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-800 hover:bg-gray-300">
                                        <i class="fas fa-desktop mr-2"></i>Cl√°sico
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Settings -->
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold mb-4">Sistema</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Cache de Performance</label>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Habilitar optimizaciones</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="cacheEnabled" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Agentes Claude</label>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Habilitar an√°lisis avanzado</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="agentsEnabled" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Auto-backup</label>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Cada 24 horas</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="autoBackup" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 flex gap-4">
                    <button onclick="saveSettings()" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-save"></i>
                        Guardar Configuraci√≥n
                    </button>
                    <button onclick="resetSettings()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-4 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-undo"></i>
                        Restablecer Valores
                    </button>
                </div>
            </div>
            
            <!-- Sincronizaci√≥n de Empleados -->
            <div class="glass-morphism rounded-2xl p-8 mt-8">
                <h2 class="text-2xl font-bold text-primary mb-6 flex items-center gap-3">
                    <i class="fas fa-sync text-blue-500"></i>
                    üîÑ Á§æÂì°„Éû„Çπ„Çø„ÉºÂêåÊúü
                </h2>
                <p class="text-secondary mb-6">
                    Sincronizar datos de empleados desde el archivo maestro en la red:<br>
                    <code class="bg-white/20 px-3 py-1 rounded text-sm text-primary">\\UNS-Kikaku\ÂÖ±Êúâ„Éï„Ç©„É´„ÉÄ\SCTDateBase\„ÄêÊñ∞„ÄëÁ§æÂì°Âè∞Â∏≥(UNS)T</code>
                </p>
                
                <!-- Stats de empleados -->
                <div id="employeeStats" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="glass-morphism rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-cyan-600">Ê¥æÈÅ£Á§æÂì°</h3>
                            <div class="w-12 h-12 bg-cyan-500/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-users text-cyan-400 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-3xl font-bold text-primary mb-2" id="hakenTotal">-</p>
                        <p class="text-cyan-400 text-sm mb-1">Âú®ËÅ∑‰∏≠: <span id="hakenActive">-</span></p>
                        <p class="text-muted text-xs">ÊúÄÁµÇÂêåÊúü: <span id="hakenLastSync">-</span></p>
                    </div>
                    <div class="glass-morphism rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-green-600">Ë´ãË≤†Á§æÂì°</h3>
                            <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-users text-green-400 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-3xl font-bold text-primary mb-2" id="ukeoiTotal">-</p>
                        <p class="text-green-400 text-sm mb-1">Âú®ËÅ∑‰∏≠: <span id="ukeoiActive">-</span></p>
                        <p class="text-muted text-xs">ÊúÄÁµÇÂêåÊúü: <span id="ukeoiLastSync">-</span></p>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-4">
                    <button onclick="syncAllEmployees()" id="syncAllBtn" class="flex-1 bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-sync"></i>
                        ÂÖ®Âì°ÂêåÊúü (Ê¥æÈÅ£ + Ë´ãË≤†)
                    </button>
                    <button onclick="syncHakenOnly()" class="flex-1 bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-user-tie"></i>
                        Ê¥æÈÅ£„ÅÆ„Åø
                    </button>
                    <button onclick="syncUkeoiOnly()" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fas fa-hard-hat"></i>
                        Ë´ãË≤†„ÅÆ„Åø
                    </button>
                </div>
                
                <div id="syncResult" class="mt-6 hidden"></div>
            </div>
        </section>

        <!-- Other tabs (Backup, Audit) - Simplified for modern UI -->
        <section id="section-backup" class="tab-content hidden">
            <div class="glass-morphism rounded-2xl p-8 text-center">
                <i class="fas fa-shield-alt text-6xl text-blue-400 mb-6"></i>
                <h2 class="text-2xl font-bold text-primary mb-4">Backup System</h2>
                <p class="text-secondary mb-6">Gesti√≥n de backups y restauraci√≥n</p>
                <button onclick="createBackup()" class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-4 px-8 rounded-xl font-semibold hover:shadow-lg transition-all duration-300">
                    <i class="fas fa-plus mr-2"></i>Crear Backup
                </button>
            </div>
        </section>

        <section id="section-audit" class="tab-content hidden">
            <div class="glass-morphism rounded-2xl p-8 text-center">
                <i class="fas fa-history text-6xl text-green-400 mb-6"></i>
                <h2 class="text-2xl font-bold text-primary mb-4">Audit Log</h2>
                <p class="text-secondary mb-6">Historial de auditor√≠a del sistema</p>
                <button onclick="loadAudit()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 px-8 rounded-xl font-semibold hover:shadow-lg transition-all duration-300">
                    <i class="fas fa-list mr-2"></i>Ver Auditor√≠a
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="glass-morphism mt-12 border-t border-white/20">
        <div class="max-w-7xl mx-auto px-6 py-6">
            <div class="flex justify-between items-center">
                <p class="text-secondary text-sm">¬© 2025 Ë≥ÉÈáëÂè∞Â∏≥ Generator v4.1 PRO</p>
                <div class="flex items-center gap-4">
                    <span class="text-secondary text-sm flex items-center gap-2">
                        <i class="fas fa-bolt text-yellow-500"></i>
                        Optimized Performance
                    </span>
                    <span class="text-secondary text-sm flex items-center gap-2">
                        <i class="fas fa-robot text-blue-500"></i>
                        AI Powered
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced Modern UI JavaScript
        const apiCache = {
            data: {},
            ttl: 60000,
            get(key) {
                const cached = this.data[key];
                if (cached && (Date.now() - cached.timestamp < this.ttl)) {
                    return cached.value;
                }
                return null;
            },
            set(key, value) {
                this.data[key] = {
                    value: value,
                    timestamp: Date.now()
                };
            },
            clear() {
                this.data = {};
            }
        };

        // Theme management
        let currentTheme = localStorage.getItem('chingin-color-theme') || 'light';
        let currentInterface = localStorage.getItem('chingin-interface-theme') || 'moderno';

        // Apply saved themes
        function applyThemes() {
            document.body.className = document.body.className.replace(/\b(light|dark)-theme\b/g, '');
            document.body.classList.add(currentTheme + '-theme');
            
            // Update UI buttons
            document.getElementById('btnLightTheme').className = currentTheme === 'light' ? 
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-blue-500 border-2 border-blue-600 text-white' : 
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-white border-2 border-gray-300 text-gray-800 hover:border-blue-500';
            
            document.getElementById('btnDarkTheme').className = currentTheme === 'dark' ? 
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-blue-500 border-2 border-blue-600 text-white' : 
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-800 border-2 border-gray-600 text-white hover:border-blue-400';
            
            document.getElementById('btnModernUI').className = currentInterface === 'moderno' ?
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gradient-to-r from-blue-500 to-cyan-600 text-white' :
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-800 hover:bg-gray-300';
            
            document.getElementById('btnClassicUI').className = currentInterface === 'clasico' ?
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gradient-to-r from-blue-500 to-cyan-600 text-white' :
                'flex-1 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-800 hover:bg-gray-300';
        }

        function setColorTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('chingin-color-theme', theme);
            applyThemes();
            showNotification(`üé® Tema ${theme === 'light' ? 'claro' : 'oscuro'} aplicado`, 'success');
        }

        function setInterfaceTheme(theme) {
            currentInterface = theme;
            localStorage.setItem('chingin-interface-theme', theme);
            applyThemes();
            if (theme === 'clasico') {
                showNotification('üîÑ Redirigiendo a interfaz cl√°sica...', 'info');
                setTimeout(() => {
                    window.location.href = '/?theme=clasico';
                }, 1000);
            } else {
                showNotification('‚úÖ Interfaz moderna seleccionada', 'success');
            }
        }

        function saveSettings() {
            const settings = {
                colorTheme: currentTheme,
                interfaceTheme: currentInterface,
                cacheEnabled: document.getElementById('cacheEnabled').checked,
                agentsEnabled: document.getElementById('agentsEnabled').checked,
                autoBackup: document.getElementById('autoBackup').checked
            };
            
            localStorage.setItem('chingin-settings', JSON.stringify(settings));
            showNotification('üíæ Configuraci√≥n guardada exitosamente', 'success');
        }

        function resetSettings() {
            if (confirm('¬øEst√°s seguro de que quieres restablecer la configuraci√≥n?')) {
                localStorage.removeItem('chingin-settings');
                localStorage.removeItem('chingin-color-theme');
                localStorage.removeItem('chingin-interface-theme');
                currentTheme = 'light';
                currentInterface = 'moderno';
                applyThemes();
                document.getElementById('cacheEnabled').checked = true;
                document.getElementById('agentsEnabled').checked = true;
                document.getElementById('autoBackup').checked = true;
                showNotification('üîÑ Configuraci√≥n restablecida', 'info');
            }
        }

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.remove('tab-active'));
            document.getElementById('section-' + tabName).classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('tab-active');
            
            if (tabName === 'data') loadData();
            if (tabName === 'audit') loadAudit();
            if (tabName === 'settings') {
                // Load saved settings
                const savedSettings = localStorage.getItem('chingin-settings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    document.getElementById('cacheEnabled').checked = settings.cacheEnabled !== false;
                    document.getElementById('agentsEnabled').checked = settings.agentsEnabled !== false;
                    document.getElementById('autoBackup').checked = settings.autoBackup !== false;
                }
            }
        }

        // Agent execution
        async function runAgent(agentType) {
            showNotification(`ü§ñ Ejecando agente ${agentType}...`, 'info');
            
            try {
                const endpoints = {
                    'payroll-analyzer': '/api/agents/analyze-payroll',
                    'anomaly-detection': '/api/agents/detect-anomalies',
                    'report-generator': '/api/agents/generate-report',
                    'trend-analysis': '/api/agents/analyze-trends',
                    'data-validation': '/api/agents/validate-data',
                    'compliance-check': '/api/agents/compliance-check'
                };
                
                const response = await fetch(endpoints[agentType], { method: 'POST' });
                const data = await response.json();
                
                if (data.status === 'ok') {
                    showNotification(`‚úÖ Agente ${agentType} completado exitosamente`, 'success');
                    console.log('Agent result:', data);
                } else {
                    showNotification(`‚ùå Error en agente ${agentType}: ${data.message}`, 'error');
                }
            } catch (error) {
                console.error('Agent error:', error);
                showNotification(`‚ùå Error ejecutando agente: ${error.message}`, 'error');
            }
        }

        // File upload
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { 
            e.preventDefault(); 
            dropZone.classList.add('border-white/70', 'bg-white/10'); 
        });
        dropZone.addEventListener('dragleave', () => { 
            dropZone.classList.remove('border-white/70', 'bg-white/10'); 
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-white/70', 'bg-white/10');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        async function handleFiles(files) {
            if (!files || files.length === 0) {
                showNotification('Por favor selecciona al menos un archivo', 'error');
                return;
            }

            const totalFiles = files.length;
            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const progressTitle = document.getElementById('progressTitle');
            const progressDetails = document.getElementById('progressDetails');
            const progressLog = document.getElementById('progressLog');

            // Reset progress
            progressBar.style.width = '0%';
            progressBar.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-emerald-600');
            progressBar.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-cyan-600');
            progressPercent.textContent = '0%';
            progressTitle.textContent = 'üöÄ Iniciando procesamiento...';
            progressDetails.textContent = '';
           
            // Show progress
            progressSection.classList.remove('hidden');
            progressLog.classList.remove('hidden');
            progressLog.innerHTML = '';

            const addLog = (msg, type = 'info') => {
                const colors = { 
                    info: 'text-green-400', 
                    success: 'text-green-300', 
                    error: 'text-red-400', 
                    warning: 'text-yellow-400',
                    cmd: 'text-cyan-400'
                };
                const icons = {
                    info: '   ',
                    success: ' ‚úì ',
                    error: ' ‚úó ',
                    warning: ' ‚ö† ',
                    cmd: ' $ '
                };
                const time = new Date().toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
                const icon = icons[type] || '   ';
                progressLog.innerHTML += `<div class="${colors[type]}"><span class="text-gray-500">[${time}]</span>${icon}${msg}</div>`;
                progressLog.scrollTop = progressLog.scrollHeight;
            };

            // Enhanced terminal logging
            addLog('chingin-processor v4.1.0 --enhanced-ui', 'cmd');
            addLog('Processing files with AI agents...', 'info');

            const formData = new FormData();
            for (let file of files) {
                formData.append('files', file);
            }

            try {
                const response = await fetch('/api/upload', { method: 'POST', body: formData });
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }

                // Success animation
                progressBar.classList.remove('from-blue-500', 'to-cyan-600');
                progressBar.classList.add('from-green-500', 'to-emerald-600');
                progressTitle.textContent = '‚úÖ Procesamiento completado exitosamente';
                progressPercent.textContent = '100%';

                addLog('All files processed successfully!', 'success');
                addLog('AI agents analysis completed', 'info');

                // Show results
                document.getElementById('fileList').classList.remove('hidden');
                const fileItems = document.getElementById('fileItems');
                fileItems.innerHTML = data.results.map(r => `
                    <div class="glass-morphism rounded-xl p-4 flex items-center justify-between">
                        <span class="text-white font-medium">${r.filename}</span>
                        <span class="${r.status === 'success' ? 'text-green-400' : 'text-red-400'} flex items-center gap-2">
                            <i class="fas ${r.status === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                            ${r.status === 'success' ? r.records + ' registros' : (r.message || 'Error')}
                        </span>
                    </div>
                `).join('');

                loadStats();
                showNotification(`‚úÖ ${data.results.filter(r => r.status === 'success').length} archivos procesados exitosamente`, 'success');

            } catch (error) {
                console.error('Error:', error);
                progressBar.classList.remove('from-blue-500', 'to-cyan-600');
                progressBar.classList.add('from-red-500', 'to-orange-600');
                progressTitle.textContent = '‚ùå Error en el procesamiento';
                progressPercent.textContent = 'Error';
                addLog(`Error: ${error.message}`, 'error');
                showNotification('Error al procesar archivos', 'error');
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 glass-morphism px-6 py-4 rounded-xl text-white font-medium z-50 flex items-center gap-3 ${
                type === 'success' ? 'bg-green-500/20' : 
                type === 'error' ? 'bg-red-500/20' : 'bg-blue-500/20'
            }`;
           
            const icon = type === 'success' ? 'fa-check-circle' : 
                         type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
           
            notification.innerHTML = `
                <i class="fas ${icon} ${
                    type === 'success' ? 'text-green-400' : 
                    type === 'error' ? 'text-red-400' : 'text-blue-400'
                }"></i>
                <span>${message}</span>
            `;
           
            document.body.appendChild(notification);
           
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 100);
           
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Load stats
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
               
                document.getElementById('statEmployees').textContent = stats.total_employees;
                document.getElementById('statRecords').textContent = stats.total_payroll_records;
                document.getElementById('statPeriods').textContent = stats.total_periods;
                document.getElementById('statNetPay').textContent = '¬•' + (stats.total_net_pay || 0).toLocaleString();
                document.getElementById('recordCount').textContent = stats.total_payroll_records + ' registros';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load data
        async function loadData() {
            try {
                const response = await fetch('/api/data');
                const data = await response.json();
               
                const tbody = document.getElementById('dataTable');
                tbody.innerHTML = data.records.map(r => `
                    <tr class="hover:bg-white/5 transition-colors duration-200">
                        <td class="px-6 py-4 text-white">${r.employee_id}</td>
                        <td class="px-6 py-4 text-white">${r.name_jp || r.name_roman || '-'}</td>
                        <td class="px-6 py-4 text-white">${r.period || '-'}</td>
                        <td class="px-6 py-4 text-right text-white font-medium">¬•${(r.total_pay || 0).toLocaleString()}</td>
                        <td class="px-6 py-4 text-right text-white">¬•${(r.deduction_total || 0).toLocaleString()}</td>
                        <td class="px-6 py-4 text-right text-white font-bold">¬•${(r.net_pay || 0).toLocaleString()}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('Error al cargar datos', 'error');
            }
        }

        // Export functions
        function exportAll() { 
            showNotification('üì• Descargando ALL...', 'info');
            window.location.href = '/api/export/all'; 
        }
        function exportMonthly() { 
            showNotification('üì• Descargando mensual...', 'info');
            window.location.href = '/api/export/monthly'; 
        }
        function exportChingin() { 
            showNotification('üì• Descargando Ë≥ÉÈáëÂè∞Â∏≥...', 'info');
            window.location.href = '/api/export/chingin'; 
        }

        // Employee search
        let currentEmployee = null;
        let employeeDataYear = null;

        async function searchEmployee() {
            const employeeId = document.getElementById('employeeIdInput').value.trim();
            if (!employeeId) {
                showNotification('Por favor ingresa el ID del empleado', 'error');
                return;
            }

            document.getElementById('employeeResult').classList.add('hidden');
            document.getElementById('employeeNotFound').classList.add('hidden');
            document.getElementById('previewSection').classList.add('hidden');

            try {
                const response = await fetch(`/api/employee/${employeeId}`);
                const data = await response.json();

                if (data.found) {
                    currentEmployee = data;

                    // Extraer el a√±o de los periodos del empleado
                    if (data.periods && data.periods.length > 0) {
                        // Los per√≠odos vienen en formato "YYYY-MM" (ej: "2025-10")
                        const firstPeriod = data.periods[0];
                        employeeDataYear = parseInt(firstPeriod.split('-')[0]);
                    } else {
                        employeeDataYear = new Date().getFullYear();
                    }

                    document.getElementById('empName').textContent = data.name_roman || data.name_jp || '-';
                    document.getElementById('empId').textContent = `ID: ${data.employee_id}`;
                    document.getElementById('empDispatch').textContent = data.dispatch || '-';
                    document.getElementById('empRecords').textContent = data.records || 0;
                    document.getElementById('empPeriods').textContent =
                        data.periods ? data.periods.slice(0, 3).join(', ') + (data.periods.length > 3 ? '...' : '') : '-';
                    document.getElementById('empKana').textContent = data.name_jp || '-';
                    document.getElementById('empRoman').textContent = data.name_roman || '-';

                    document.getElementById('employeeResult').classList.remove('hidden');
                    document.getElementById('employeeNotFound').classList.add('hidden');
                   
                    showNotification('‚úÖ Empleado encontrado', 'success');
                } else {
                    document.getElementById('employeeNotFound').classList.remove('hidden');
                    document.getElementById('employeeResult').classList.add('hidden');
                    showNotification('Empleado no encontrado', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error al buscar empleado', 'error');
            }
        }

        async function previewChingin() {
            if (!currentEmployee) return;

            // Usar el a√±o extra√≠do de los datos del empleado
            const year = employeeDataYear || new Date().getFullYear();
            
            try {
                const response = await fetch(`/api/employee/${currentEmployee.employee_id}/preview?year=${year}`);
                if (!response.ok) {
                    throw new Error('No hay datos para este a√±o');
                }
                const data = await response.json();
                
                // Llenar tabla de preview
                const tbody = document.getElementById('previewTable');
                let html = '';
                let totals = { workDays: 0, workHours: 0, overtimeHours: 0, basePay: 0, overtimePay: 0, totalPay: 0, deduction: 0, netPay: 0 };
                
                const monthNames = ['', '1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
                
                // Funci√≥n para formatear horas decimales
                const formatHours = (h) => {
                    if (!h) return '0';
                    return Math.round(h * 10) / 10;  // Redondear a 1 decimal
                };
                
                for (let month = 1; month <= 12; month++) {
                    const m = data.data_by_month[month];
                    if (m) {
                        html += `
                            <tr class="hover:bg-white/5 transition-colors duration-200">
                                <td class="px-6 py-4 text-primary font-medium">${monthNames[month]}</td>
                                <td class="px-6 py-4 text-center text-white">${m.work_days || 0}</td>
                                <td class="px-6 py-4 text-center text-white">${formatHours(m.work_hours)}h</td>
                                <td class="px-6 py-4 text-center text-white">${formatHours(m.overtime_hours)}h</td>
                                <td class="px-6 py-4 text-right text-white">¬•${(m.base_pay || 0).toLocaleString()}</td>
                                <td class="px-6 py-4 text-right text-white">¬•${(m.overtime_pay || 0).toLocaleString()}</td>
                                <td class="px-6 py-4 text-right text-white">¬•${(m.total_pay || 0).toLocaleString()}</td>
                                <td class="px-6 py-4 text-right text-white">¬•${(m.deduction_total || 0).toLocaleString()}</td>
                                <td class="px-6 py-4 text-right text-white font-bold text-green-400">¬•${(m.net_pay || 0).toLocaleString()}</td>
                            </tr>
                        `;
                        totals.workDays += m.work_days || 0;
                        totals.workHours += m.work_hours || 0;
                        totals.overtimeHours += m.overtime_hours || 0;
                        totals.basePay += m.base_pay || 0;
                        totals.overtimePay += m.overtime_pay || 0;
                        totals.totalPay += m.total_pay || 0;
                        totals.deduction += m.deduction_total || 0;
                        totals.netPay += m.net_pay || 0;
                    } else {
                        html += `
                            <tr class="text-gray-400">
                                <td class="px-6 py-4 text-primary font-medium">${monthNames[month]}</td>
                                <td class="px-6 py-4 text-center">-</td>
                                <td class="px-6 py-4 text-center">-</td>
                                <td class="px-6 py-4 text-center">-</td>
                                <td class="px-6 py-4 text-right">-</td>
                                <td class="px-6 py-4 text-right">-</td>
                                <td class="px-6 py-4 text-right">-</td>
                                <td class="px-6 py-4 text-right">-</td>
                                <td class="px-6 py-4 text-right">-</td>
                            </tr>
                        `;
                    }
                }
                
                tbody.innerHTML = html;
                
                // Totales (redondear horas a 1 decimal)
                document.getElementById('totalWorkDays').textContent = totals.workDays;
                document.getElementById('totalWorkHours').textContent = (Math.round(totals.workHours * 10) / 10) + 'h';
                document.getElementById('totalOvertimeHours').textContent = (Math.round(totals.overtimeHours * 10) / 10) + 'h';
                document.getElementById('totalBasePay').textContent = '¬•' + totals.basePay.toLocaleString();
                document.getElementById('totalOvertimePay').textContent = '¬•' + totals.overtimePay.toLocaleString();
                document.getElementById('totalPay').textContent = '¬•' + totals.totalPay.toLocaleString();
                document.getElementById('totalDeduction').textContent = '¬•' + totals.deduction.toLocaleString();
                document.getElementById('totalNetPay').textContent = '¬•' + totals.netPay.toLocaleString();
                
                document.getElementById('previewSection').classList.remove('hidden');
                showNotification('üëÅÔ∏è Vista previa cargada', 'success');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error al cargar preview: ' + error.message, 'error');
            }
        }

        function generateChingin() {
            if (!currentEmployee) {
                showNotification('‚ö†Ô∏è ÂæìÊ•≠Âì°„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ / Por favor, busca un empleado primero', 'error');
                return;
            }

            // Usar el a√±o extra√≠do de los datos del empleado en lugar del yearSelect
            const year = employeeDataYear || new Date().getFullYear();
            const format = document.getElementById('chinginFormat').value;
            const outputType = document.getElementById('chinginOutputType').value;

            console.log(`Generando Ë≥ÉÈáëÂè∞Â∏≥: ID=${currentEmployee.employee_id}, Year=${year}, Format=${format}, Output=${outputType}`);
            showNotification('üì• Generando Ë≥ÉÈáëÂè∞Â∏≥...', 'info');
            window.location.href = `/api/employee/${currentEmployee.employee_id}/chingin-v2?year=${year}&format=${format}&output_type=${outputType}`;
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de que quieres borrar TODOS los datos?')) {
                showNotification('üóëÔ∏è Borrando todos los datos...', 'info');
                // Implementation would go here
            }
        }

        function createBackup() {
            showNotification('üíæ Creando backup...', 'info');
            // Implementation would go here
        }

        function loadAudit() {
            showNotification('üìã Cargando auditor√≠a...', 'info');
            // Implementation would go here
        }

        function toggleThemeSelector() {
            // This function can be used to show/hide theme selector if needed
            showNotification('üé® Usa la pesta√±a Configuraci√≥n para cambiar temas', 'info');
        }

        // ========================================
        // Ë≥ÉÈáëÂè∞Â∏≥ - Navegaci√≥n por F√°brica/Empresa
        // ========================================
        
        // Cargar f√°bricas (Ê¥æÈÅ£ÂÖà) al cargar la p√°gina
        async function loadDispatchCompanies() {
            try {
                const response = await fetch('/api/dispatch-companies');
                const data = await response.json();
                
                const select = document.getElementById('companySelect');
                select.innerHTML = '<option value="">-- ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ --</option>';
                
                data.companies.forEach(company => {
                    const opt = document.createElement('option');
                    opt.value = company.name;
                    opt.textContent = `${company.name} (${company.count}‰∫∫)`;
                    select.appendChild(opt);
                });
                
                // Tambi√©n cargar Ë´ãË≤†Á§æÂì° (todos)
                await loadUkeoiEmployees();
            } catch (error) {
                console.error('Error cargando f√°bricas:', error);
                showNotification('Error al cargar f√°bricas', 'error');
            }
        }
        
        // Cargar todos los Ë´ãË≤†Á§æÂì°
        async function loadUkeoiEmployees() {
            try {
                const response = await fetch('/api/ukeoi-employees');
                const data = await response.json();
                
                const select = document.getElementById('ukeoiEmployeeSelect');
                const countLabel = document.getElementById('ukeoiEmployeeCount');
                
                select.innerHTML = '<option value="">-- ÂæìÊ•≠Âì°„ÇíÈÅ∏Êäû (ÂÄãÂà•) --</option>';
                
                if (data.employees) {
                    data.employees.forEach(emp => {
                        const opt = document.createElement('option');
                        opt.value = emp.employee_id;
                        opt.textContent = `${emp.employee_id} - ${emp.name}`;
                        select.appendChild(opt);
                    });
                    countLabel.textContent = `${data.employees.length}‰∫∫„ÅÆË´ãË≤†Á§æÂì°`;
                }
            } catch (error) {
                console.error('Error cargando Ë´ãË≤†Á§æÂì°:', error);
                showNotification('Error al cargar empleados Ë´ãË≤†', 'error');
            }
        }
        
        // Seleccionar Ë´ãË≤†Á§æÂì° individual
        function selectUkeoiEmployee() {
            const empId = document.getElementById('ukeoiEmployeeSelect').value;
            if (empId) {
                document.getElementById('employeeIdInput').value = empId;
                searchEmployee();
            }
        }
        
        // Generar todos los Ë´ãË≤†Á§æÂì°
        async function generateAllUkeoi() {
            const year = document.getElementById('yearSelect').value;
            const btn = document.getElementById('btnGenerateAllUkeoi');
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ÁîüÊàê‰∏≠...';
            
            try {
                const response = await fetch(`/api/chingin/all-ukeoi?year=${year}`);
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error al generar');
                }
                
                // Descargar el ZIP
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Ë≥ÉÈáëÂè∞Â∏≥_Ë´ãË≤†Á§æÂì°_Â≤°Â±±Â∑•Â†¥_${year}.zip`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                a.remove();
                
                btn.innerHTML = '<i class="fas fa-check mr-2"></i>‚úÖ ÂÆå‰∫Ü!';
                showNotification('‚úÖ Ë´ãË≤†Á§æÂì° completado exitosamente', 'success');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Error:', error);
                showNotification('„Ç®„É©„Éº: ' + error.message, 'error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        
        // Cargar empleados de una f√°brica
        async function loadCompanyEmployees() {
            const company = document.getElementById('companySelect').value;
            const select = document.getElementById('companyEmployeeSelect');
            const btnGenerate = document.getElementById('btnGenerateAllCompany');
            const countLabel = document.getElementById('companyEmployeeCount');
            
            if (!company) {
                select.innerHTML = '<option value="">-- ÂÖà„Å´Ê¥æÈÅ£ÂÖà„ÇíÈÅ∏Êäû --</option>';
                select.disabled = true;
                btnGenerate.disabled = true;
                countLabel.textContent = '--';
                return;
            }
            
            try {
                const response = await fetch(`/api/employees-by-company/${encodeURIComponent(company)}`);
                const data = await response.json();
                
                select.innerHTML = '<option value="">-- ÂæìÊ•≠Âì°„ÇíÈÅ∏Êäû (ÂÄãÂà•) --</option>';
                data.employees.forEach(emp => {
                    const opt = document.createElement('option');
                    opt.value = emp.id;
                    opt.textContent = `${emp.id} - ${emp.name}`;
                    select.appendChild(opt);
                });
                select.disabled = false;
                
                // Habilitar bot√≥n de generar todos
                btnGenerate.disabled = data.count === 0;
                countLabel.textContent = `${data.count}‰∫∫„ÅÆÂæìÊ•≠Âì°`;
            } catch (error) {
                console.error('Error cargando empleados:', error);
                showNotification('Error al cargar empleados de la f√°brica', 'error');
            }
        }
        
        // Seleccionar empleado de f√°brica
        function selectCompanyEmployee() {
            const empId = document.getElementById('companyEmployeeSelect').value;
            if (empId) {
                document.getElementById('employeeIdInput').value = empId;
                searchEmployee();
            }
        }
        
        // Generar Ë≥ÉÈáëÂè∞Â∏≥ de todos los empleados de una f√°brica
        async function generateAllByCompany() {
            const company = document.getElementById('companySelect').value;
            const year = document.getElementById('yearSelect').value;
            
            if (!company) {
                showNotification('Ê¥æÈÅ£ÂÖà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const btn = document.getElementById('btnGenerateAllCompany');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ÁîüÊàê‰∏≠...';
            
            try {
                const response = await fetch(`/api/chingin/by-company/${encodeURIComponent(company)}?year=${year}`);
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error al generar');
                }
                
                // Descargar el ZIP
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Ë≥ÉÈáëÂè∞Â∏≥_${company}_${year}.zip`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                a.remove();
                
                btn.innerHTML = '<i class="fas fa-check mr-2"></i>‚úÖ ÂÆå‰∫Ü!';
                showNotification(`‚úÖ Ë≥ÉÈáëÂè∞Â∏≥ de ${company} completado`, 'success');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Error:', error);
                showNotification('„Ç®„É©„Éº: ' + error.message, 'error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // ========================================
        // SINCRONIZACI√ìN DE EMPLEADOS
        // ========================================
        
        async function loadEmployeeStats() {
            try {
                const response = await fetch('/api/employee-master-stats');
                const stats = await response.json();
                
                document.getElementById('hakenTotal').textContent = stats.haken_total || 0;
                document.getElementById('hakenActive').textContent = stats.haken_active || 0;
                document.getElementById('hakenLastSync').textContent = stats.haken_last_sync ?
                    new Date(stats.haken_last_sync).toLocaleString('ja-JP') : 'Êú™ÂêåÊúü';
                
                document.getElementById('ukeoiTotal').textContent = stats.ukeoi_total || 0;
                document.getElementById('ukeoiActive').textContent = stats.ukeoi_active || 0;
                document.getElementById('ukeoiLastSync').textContent = stats.ukeoi_last_sync ?
                    new Date(stats.ukeoi_last_sync).toLocaleString('ja-JP') : 'Êú™ÂêåÊúü';
            } catch (error) {
                console.error('Error loading employee stats:', error);
            }
        }
        
        async function syncAllEmployees() {
            const btn = document.getElementById('syncAllBtn');
            const resultDiv = document.getElementById('syncResult');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ÂêåÊúü‰∏≠...';
            resultDiv.classList.add('hidden');
            
            try {
                const response = await fetch('/api/sync-employees', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-green-500/20 border border-green-500/30';
                    resultDiv.innerHTML = `
                        <p class="text-green-400 font-bold text-lg mb-3">‚úÖ ÂêåÊúüÂÆå‰∫ÜÔºÅ</p>
                        <p class="text-white/90 text-sm">
                            Ê¥æÈÅ£Á§æÂì°: Êñ∞Ë¶è ${result.haken?.inserted || 0}‰ª∂, Êõ¥Êñ∞ ${result.haken?.updated || 0}‰ª∂<br>
                            Ë´ãË≤†Á§æÂì°: Êñ∞Ë¶è ${result.ukeoi?.inserted || 0}‰ª∂, Êõ¥Êñ∞ ${result.ukeoi?.updated || 0}‰ª∂
                        </p>
                    `;
                    showNotification('‚úÖ Sincronizaci√≥n completada exitosamente', 'success');
                } else {
                    resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-red-500/20 border border-red-500/30';
                    resultDiv.innerHTML = `
                        <p class="text-red-400 font-bold text-lg mb-3">‚ùå „Ç®„É©„Éº</p>
                        <p class="text-white/90 text-sm">${result.error || result.haken?.error || result.ukeoi?.error}</p>
                    `;
                    showNotification('‚ùå Error en sincronizaci√≥n', 'error');
                }
                resultDiv.classList.remove('hidden');
                loadEmployeeStats();
            } catch (error) {
                resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-red-500/20 border border-red-500/30';
                resultDiv.innerHTML = `
                    <p class="text-red-400 font-bold text-lg mb-3">‚ùå „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº</p>
                    <p class="text-white/90 text-sm">${error.message}</p>
                `;
                resultDiv.classList.remove('hidden');
                showNotification('‚ùå Error de red', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sync mr-2"></i>ÂÖ®Âì°ÂêåÊúü (Ê¥æÈÅ£ + Ë´ãË≤†)';
            }
        }
        
        async function syncHakenOnly() {
            const resultDiv = document.getElementById('syncResult');
            resultDiv.innerHTML = '<p class="text-white/70">‚è≥ Ê¥æÈÅ£Á§æÂì°„ÇíÂêåÊúü‰∏≠...</p>';
            resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-blue-500/20 border border-blue-500/30';
            resultDiv.classList.remove('hidden');
            
            try {
                const response = await fetch('/api/sync-haken', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-blue-500/20 border border-blue-500/30';
                    resultDiv.innerHTML = `<p class="text-blue-400 font-bold">‚úÖ Ê¥æÈÅ£Á§æÂì°ÂêåÊúüÂÆå‰∫Ü: Êñ∞Ë¶è ${result.inserted}‰ª∂, Êõ¥Êñ∞ ${result.updated}‰ª∂</p>`;
                    showNotification('‚úÖ Ê¥æÈÅ£Á§æÂì° sincronizados', 'success');
                } else {
                    resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-red-500/20 border border-red-500/30';
                    resultDiv.innerHTML = `<p class="text-red-400 font-bold">‚ùå ${result.error}</p>`;
                    showNotification('‚ùå Error en Ê¥æÈÅ£Á§æÂì°', 'error');
                }
                loadEmployeeStats();
            } catch (error) {
                resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-red-500/20 border border-red-500/30';
                resultDiv.innerHTML = `<p class="text-red-400 font-bold">‚ùå ${error.message}</p>`;
                showNotification('‚ùå Error de red', 'error');
            }
        }
        
        async function syncUkeoiOnly() {
            const resultDiv = document.getElementById('syncResult');
            resultDiv.innerHTML = '<p class="text-white/70">‚è≥ Ë´ãË≤†Á§æÂì°„ÇíÂêåÊúü‰∏≠...</p>';
            resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-green-500/20 border border-green-500/30';
            resultDiv.classList.remove('hidden');
            
            try {
                const response = await fetch('/api/sync-ukeoi', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-green-500/20 border border-green-500/30';
                    resultDiv.innerHTML = `<p class="text-green-400 font-bold">‚úÖ Ë´ãË≤†Á§æÂì°ÂêåÊúüÂÆå‰∫Ü: Êñ∞Ë¶è ${result.inserted}‰ª∂, Êõ¥Êñ∞ ${result.updated}‰ª∂</p>`;
                    showNotification('‚úÖ Ë´ãË≤†Á§æÂì° sincronizados', 'success');
                } else {
                    resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-red-500/20 border border-red-500/30';
                    resultDiv.innerHTML = `<p class="text-red-400 font-bold">‚ùå ${result.error}</p>`;
                    showNotification('‚ùå Error en Ë´ãË≤†Á§æÂì°', 'error');
                }
                loadEmployeeStats();
            } catch (error) {
                resultDiv.className = 'mt-6 p-6 glass-morphism rounded-2xl bg-red-500/20 border border-red-500/30';
                resultDiv.innerHTML = `<p class="text-red-400 font-bold">‚ùå ${error.message}</p>`;
                showNotification('‚ùå Error de red', 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            applyThemes();
            loadStats();
            loadEmployeeStats();
            // Cargar las f√°bricas cuando se carga la p√°gina
            loadDispatchCompanies();
            showNotification('üöÄ Ë≥ÉÈáëÂè∞Â∏≥ Generator v4.1 PRO Enhanced listo', 'success');
        });
    </script>
</body>
</html>
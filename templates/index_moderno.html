<!DOCTYPE html>
<html lang="ja" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>賃金台帳 Generator v4.1 PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts - Inter para tipografía moderna -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Script para evitar parpadeo de tema -->
    <script>
        // Ejecutar antes de que se renderice la página para evitar flash
        (function() {
            const savedTheme = localStorage.getItem('chingin-color-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.remove('light');
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
                document.documentElement.classList.add('light');
            }
        })();
    </script>

    <script>
        // Configuración de Tailwind para modo oscuro
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        surface: {
                            light: '#ffffff',
                            dark: '#1f2937',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        * {
            font-family: 'Inter', system-ui, sans-serif;
        }

        /* ========== TEMA CLARO (DEFAULT) ========== */
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --card-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --card-shadow-hover: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* ========== TEMA OSCURO ========== */
        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border-color: #334155;
            --accent-color: #60a5fa;
            --accent-hover: #3b82f6;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --error-color: #f87171;
            --card-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.3);
            --card-shadow-hover: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* ========== COMPONENTES PRINCIPALES ========== */
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--card-shadow-hover);
            transform: translateY(-2px);
        }

        .card-static {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: var(--card-shadow);
        }

        /* ========== HEADER ========== */
        .header-glass {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        /* ========== NAVEGACIÓN TABS ========== */
        .nav-tabs {
            background-color: var(--bg-tertiary);
            border-radius: 1rem;
            padding: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background-color: var(--accent-color);
            color: white;
            box-shadow: 0 4px 6px -1px rgb(59 130 246 / 0.3);
        }

        /* ========== STAT CARDS ========== */
        .stat-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-shadow-hover);
        }

        .stat-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* ========== FORMULARIOS ========== */
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        /* ========== SELECT CORREGIDO ========== */
        .form-select {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1);
        }

        /* Opciones del select - tema claro */
        .form-select option {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            padding: 0.75rem;
        }

        /* Dark mode select options */
        .dark .form-select option {
            background-color: #1e293b;
            color: #f1f5f9;
        }

        /* ========== BOTONES ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgb(59 130 246 / 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 12px -2px rgb(59 130 246 / 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgb(16 185 129 / 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 12px -2px rgb(16 185 129 / 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgb(239 68 68 / 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
        }

        /* ========== DROP ZONE ========== */
        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 1rem;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background-color: var(--bg-tertiary);
        }

        .drop-zone:hover,
        .drop-zone.drag-over {
            border-color: var(--accent-color);
            background-color: rgb(59 130 246 / 0.05);
        }

        .drop-zone-icon {
            width: 5rem;
            height: 5rem;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 2rem;
        }

        /* ========== TABLA DE DATOS ========== */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .data-table thead {
            background-color: var(--bg-tertiary);
        }

        .data-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .data-table th:first-child {
            border-top-left-radius: 0.75rem;
        }

        .data-table th:last-child {
            border-top-right-radius: 0.75rem;
        }

        .data-table td {
            padding: 1rem;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tbody tr {
            transition: background-color 0.2s ease;
        }

        .data-table tbody tr:hover {
            background-color: var(--bg-tertiary);
        }

        /* ========== TERMINAL/LOG ========== */
        .terminal {
            background-color: #0f172a;
            color: #10b981;
            font-family: 'Fira Code', 'Consolas', monospace;
            border-radius: 0.75rem;
            padding: 1rem;
            font-size: 0.875rem;
            line-height: 1.6;
            max-height: 20rem;
            overflow-y: auto;
        }

        .terminal .log-info { color: #60a5fa; }
        .terminal .log-success { color: #34d399; }
        .terminal .log-warning { color: #fbbf24; }
        .terminal .log-error { color: #f87171; }
        .terminal .log-time { color: #64748b; }

        /* ========== PROGRESS BAR ========== */
        .progress-container {
            background-color: var(--bg-tertiary);
            border-radius: 9999px;
            height: 0.75rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 9999px;
            background: linear-gradient(90deg, #3b82f6, #2563eb);
            transition: width 0.5s ease;
        }

        .progress-bar.success {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .progress-bar.error {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        /* ========== NOTIFICACIONES ========== */
        .notification {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        .notification.success {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .notification.error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .notification.info {
            background-color: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .dark .notification.success {
            background-color: #166534;
            color: #dcfce7;
            border-color: #22c55e;
        }

        .dark .notification.error {
            background-color: #991b1b;
            color: #fee2e2;
            border-color: #ef4444;
        }

        .dark .notification.info {
            background-color: #1e40af;
            color: #dbeafe;
            border-color: #3b82f6;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ========== THEME TOGGLE ========== */
        .theme-toggle {
            width: 4rem;
            height: 2rem;
            background-color: var(--bg-tertiary);
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            width: 1.5rem;
            height: 1.5rem;
            background-color: white;
            border-radius: 50%;
            top: 50%;
            left: 0.25rem;
            transform: translateY(-50%);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
        }

        .dark .theme-toggle {
            background-color: #3b82f6;
        }

        .dark .theme-toggle::before {
            left: calc(100% - 1.75rem);
        }

        .theme-toggle-icons {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 0.5rem;
            font-size: 0.75rem;
        }

        .theme-toggle-icons .sun {
            color: #f59e0b;
        }

        .theme-toggle-icons .moon {
            color: #f1f5f9;
        }

        /* ========== BADGE ========== */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
        }

        .badge-success {
            background-color: #dcfce7;
            color: #166534;
        }

        .badge-info {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .badge-warning {
            background-color: #fef3c7;
            color: #92400e;
        }

        .dark .badge-success {
            background-color: #166534;
            color: #dcfce7;
        }

        .dark .badge-info {
            background-color: #1e40af;
            color: #dbeafe;
        }

        .dark .badge-warning {
            background-color: #92400e;
            color: #fef3c7;
        }

        /* ========== EXPORT CARDS ========== */
        .export-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .export-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-shadow-hover);
        }

        .export-icon {
            width: 4rem;
            height: 4rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }

        /* ========== FOOTER ========== */
        .footer {
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 1.5rem;
            margin-top: 3rem;
        }

        /* ========== ANIMACIONES ========== */
        .animate-fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== SCROLLBAR PERSONALIZADO ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="header-glass sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo y Título -->
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-file-invoice-dollar text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold" style="color: var(--text-primary)">賃金台帳 Generator</h1>
                        <p class="text-sm" style="color: var(--text-secondary)">v4.1 PRO</p>
                    </div>
                </div>

                <!-- Controles del Header -->
                <div class="flex items-center gap-4">
                    <!-- Contador de Registros -->
                    <div class="hidden md:flex items-center gap-2 px-4 py-2 rounded-lg" style="background-color: var(--bg-tertiary)">
                        <i class="fas fa-database" style="color: var(--accent-color)"></i>
                        <span id="recordCount" class="text-sm font-medium" style="color: var(--text-primary)">0 件</span>
                    </div>

                    <!-- Toggle Tema Claro/Oscuro -->
                    <div class="flex items-center gap-3">
                        <span class="text-sm font-medium hidden sm:block" style="color: var(--text-secondary)">テーマ</span>
                        <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" aria-label="テーマ切替">
                            <div class="theme-toggle-icons">
                                <i class="fas fa-sun sun"></i>
                                <i class="fas fa-moon moon"></i>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Stats Dashboard -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 animate-fade-in">
            <!-- Empleados -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-4">
                    <div class="stat-icon bg-blue-100 dark:bg-blue-900/30">
                        <i class="fas fa-users text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <span class="badge badge-info">従業員</span>
                </div>
                <p class="stat-label">従業員数</p>
                <p id="statEmployees" class="stat-value">0</p>
            </div>

            <!-- Registros -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-4">
                    <div class="stat-icon bg-green-100 dark:bg-green-900/30">
                        <i class="fas fa-file-alt text-green-600 dark:text-green-400"></i>
                    </div>
                    <span class="badge badge-success">記録</span>
                </div>
                <p class="stat-label">給与記録</p>
                <p id="statRecords" class="stat-value">0</p>
            </div>

            <!-- Periodos -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-4">
                    <div class="stat-icon bg-purple-100 dark:bg-purple-900/30">
                        <i class="fas fa-calendar-alt text-purple-600 dark:text-purple-400"></i>
                    </div>
                    <span class="badge badge-info">期間</span>
                </div>
                <p class="stat-label">期間数</p>
                <p id="statPeriods" class="stat-value">0</p>
            </div>

            <!-- Total Neto -->
            <div class="stat-card">
                <div class="flex items-center justify-between mb-4">
                    <div class="stat-icon bg-amber-100 dark:bg-amber-900/30">
                        <i class="fas fa-yen-sign text-amber-600 dark:text-amber-400"></i>
                    </div>
                    <span class="badge badge-warning">合計</span>
                </div>
                <p class="stat-label">差引支給額合計</p>
                <p id="statNetPay" class="stat-value">¥0</p>
            </div>
        </section>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs mb-8">
            <div class="flex flex-wrap gap-2">
                <button onclick="showTab('upload')" id="tab-upload" class="nav-tab active">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span class="hidden sm:inline">アップロード</span>
                </button>
                <button onclick="showTab('data')" id="tab-data" class="nav-tab">
                    <i class="fas fa-database"></i>
                    <span class="hidden sm:inline">データ一覧</span>
                </button>
                <button onclick="showTab('export')" id="tab-export" class="nav-tab">
                    <i class="fas fa-download"></i>
                    <span class="hidden sm:inline">エクスポート</span>
                </button>
                <button onclick="showTab('chingin')" id="tab-chingin" class="nav-tab">
                    <i class="fas fa-file-invoice"></i>
                    <span class="hidden sm:inline">賃金台帳</span>
                </button>
                <button onclick="showTab('backup')" id="tab-backup" class="nav-tab">
                    <i class="fas fa-shield-alt"></i>
                    <span class="hidden sm:inline">バックアップ</span>
                </button>
                <button onclick="showTab('audit')" id="tab-audit" class="nav-tab">
                    <i class="fas fa-history"></i>
                    <span class="hidden sm:inline">監査ログ</span>
                </button>
                <button onclick="showTab('settings')" id="tab-settings" class="nav-tab">
                    <i class="fas fa-cog"></i>
                    <span class="hidden sm:inline">設定</span>
                </button>
            </div>
        </nav>

        <!-- Tab: Upload -->
        <section id="section-upload" class="tab-content">
            <div class="card-static p-8 mb-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <h2 class="text-xl font-bold flex items-center gap-3" style="color: var(--text-primary)">
                        <i class="fas fa-cloud-upload-alt" style="color: var(--accent-color)"></i>
                        ファイルアップロード
                    </h2>
                    <button onclick="clearAllData()" class="btn btn-danger">
                        <i class="fas fa-trash-alt"></i>
                        全データ削除
                    </button>
                </div>

                <!-- Drop Zone -->
                <div id="dropZone" class="drop-zone">
                    <div class="drop-zone-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p class="text-lg font-semibold mb-2" style="color: var(--text-primary)">ファイルをドラッグ＆ドロップ</p>
                    <p class="mb-4" style="color: var(--text-secondary)">またはクリックしてファイルを選択</p>
                    <div class="flex justify-center gap-2">
                        <span class="badge badge-info">.xlsm</span>
                        <span class="badge badge-info">.xlsx</span>
                        <span class="badge badge-info">.xls</span>
                    </div>
                    <input type="file" id="fileInput" multiple accept=".xlsm,.xlsx,.xls" class="hidden">
                </div>

                <!-- Progress Section -->
                <div id="progressSection" class="hidden mt-6">
                    <div class="card-static p-6">
                        <div class="flex justify-between items-center mb-4">
                            <span id="progressTitle" class="font-semibold" style="color: var(--text-primary)">処理中...</span>
                            <span id="progressPercent" class="font-bold" style="color: var(--accent-color)">0%</span>
                        </div>
                        <div class="progress-container mb-4">
                            <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                        </div>
                        <div id="progressLog" class="terminal hidden mt-4"></div>
                    </div>
                </div>

                <!-- File List -->
                <div id="fileList" class="mt-6 hidden">
                    <h3 class="font-semibold mb-4 flex items-center gap-2" style="color: var(--text-primary)">
                        <i class="fas fa-check-circle text-green-500"></i>
                        処理済みファイル
                    </h3>
                    <div id="fileItems" class="space-y-2"></div>
                </div>
            </div>
        </section>

        <!-- Tab: Data -->
        <section id="section-data" class="tab-content hidden">
            <div class="card-static p-8">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <h2 class="text-xl font-bold flex items-center gap-3" style="color: var(--text-primary)">
                        <i class="fas fa-database" style="color: var(--success-color)"></i>
                        給与データ一覧
                    </h2>
                    <div class="flex gap-3">
                        <button onclick="clearAllData()" class="btn btn-danger">
                            <i class="fas fa-trash-alt"></i>
                            全削除
                        </button>
                        <button onclick="loadData()" class="btn btn-primary">
                            <i class="fas fa-sync-alt"></i>
                            更新
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto rounded-xl" style="border: 1px solid var(--border-color)">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>従業員番号</th>
                                <th>氏名</th>
                                <th>支給分</th>
                                <th class="text-right">総支給額</th>
                                <th class="text-right">控除合計</th>
                                <th class="text-right">差引支給額</th>
                            </tr>
                        </thead>
                        <tbody id="dataTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Tab: Export -->
        <section id="section-export" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- ALL Export -->
                <div class="export-card">
                    <div class="export-icon bg-gradient-to-br from-green-500 to-emerald-600">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-2" style="color: var(--text-primary)">ALL出力</h3>
                    <span class="badge badge-success mb-3">Excel</span>
                    <p class="mb-4" style="color: var(--text-secondary)">全データを1つのファイルに統合</p>
                    <button onclick="exportAll()" class="btn btn-success w-full">
                        <i class="fas fa-download"></i>
                        ダウンロード
                    </button>
                </div>

                <!-- Monthly Export -->
                <div class="export-card">
                    <div class="export-icon bg-gradient-to-br from-blue-500 to-blue-600">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-2" style="color: var(--text-primary)">月別分割</h3>
                    <span class="badge badge-info mb-3">月別</span>
                    <p class="mb-4" style="color: var(--text-secondary)">月ごとにシート分割</p>
                    <button onclick="exportMonthly()" class="btn btn-primary w-full">
                        <i class="fas fa-download"></i>
                        ダウンロード
                    </button>
                </div>

                <!-- Chingin Export -->
                <div class="export-card">
                    <div class="export-icon bg-gradient-to-br from-amber-500 to-orange-600">
                        <i class="fas fa-file-archive"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-2" style="color: var(--text-primary)">賃金台帳</h3>
                    <span class="badge badge-warning mb-3">ZIP</span>
                    <p class="mb-4" style="color: var(--text-secondary)">従業員ごとに個別ファイル</p>
                    <button onclick="exportChingin()" class="btn btn-primary w-full" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <i class="fas fa-download"></i>
                        ダウンロード
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab: Chingin -->
        <section id="section-chingin" class="tab-content hidden">
            <div class="card-static p-8 mb-6">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-3" style="color: var(--text-primary)">
                    <i class="fas fa-file-invoice" style="color: var(--warning-color)"></i>
                    賃金台帳 - 従業員別作成
                </h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block font-medium mb-2" style="color: var(--text-primary)">
                            <i class="fas fa-search mr-2" style="color: var(--accent-color)"></i>
                            従業員番号 (ID)
                        </label>
                        <input type="text" id="employeeIdInput" placeholder="例: 504010"
                               class="form-input"
                               onkeypress="if(event.key==='Enter') searchEmployee()">
                    </div>

                    <div>
                        <label class="block font-medium mb-2" style="color: var(--text-primary)">
                            <i class="fas fa-calendar mr-2" style="color: var(--accent-color)"></i>
                            年度
                        </label>
                        <select id="yearSelect" class="form-select">
                            <option value="2025">2025年</option>
                            <option value="2024">2024年</option>
                            <option value="2023">2023年</option>
                        </select>
                    </div>
                </div>

                <button onclick="searchEmployee()" class="btn btn-primary w-full sm:w-auto">
                    <i class="fas fa-search"></i>
                    検索
                </button>
            </div>

            <!-- Employee Result -->
            <div id="employeeResult" class="hidden">
                <div class="card-static p-8 mb-6">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
                        <div>
                            <h3 class="text-2xl font-bold" id="empName" style="color: var(--text-primary)">-</h3>
                            <p id="empId" style="color: var(--text-secondary)">-</p>
                        </div>
                        <div class="text-left sm:text-right">
                            <p class="text-sm" style="color: var(--text-muted)">派遣先</p>
                            <p class="font-medium" id="empDispatch" style="color: var(--text-primary)">-</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="p-4 rounded-xl" style="background-color: var(--bg-tertiary)">
                            <p class="text-sm mb-1" style="color: var(--text-muted)">登録数</p>
                            <p class="text-2xl font-bold" id="empRecords" style="color: var(--accent-color)">0</p>
                        </div>
                        <div class="p-4 rounded-xl" style="background-color: var(--bg-tertiary)">
                            <p class="text-sm mb-1" style="color: var(--text-muted)">対象期間</p>
                            <p class="text-lg font-semibold" id="empPeriods" style="color: var(--success-color)">-</p>
                        </div>
                        <div class="p-4 rounded-xl" style="background-color: var(--bg-tertiary)">
                            <p class="text-sm mb-1" style="color: var(--text-muted)">氏名</p>
                            <p class="font-semibold" id="empKana" style="color: var(--accent-color)">-</p>
                            <p class="text-sm" id="empRoman" style="color: var(--text-secondary)">-</p>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4">
                        <button onclick="generateChingin()" class="btn btn-success flex-1">
                            <i class="fas fa-download"></i>
                            賃金台帳をダウンロード
                        </button>
                        <button onclick="previewChingin()" class="btn btn-primary flex-1">
                            <i class="fas fa-eye"></i>
                            プレビュー
                        </button>
                    </div>
                </div>
            </div>

            <!-- Not Found -->
            <div id="employeeNotFound" class="hidden">
                <div class="card-static p-12 text-center">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center" style="background-color: rgb(239 68 68 / 0.1)">
                        <i class="fas fa-user-slash text-3xl" style="color: var(--error-color)"></i>
                    </div>
                    <p class="text-xl font-semibold mb-2" style="color: var(--error-color)">従業員が見つかりません</p>
                    <p style="color: var(--text-secondary)">データベースに該当する従業員が見つかりませんでした</p>
                </div>
            </div>
        </section>

        <!-- Tab: Backup -->
        <section id="section-backup" class="tab-content hidden">
            <div class="card-static p-8 text-center">
                <div class="w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center" style="background-color: rgb(59 130 246 / 0.1)">
                    <i class="fas fa-shield-alt text-3xl" style="color: var(--accent-color)"></i>
                </div>
                <h2 class="text-2xl font-bold mb-4" style="color: var(--text-primary)">バックアップシステム</h2>
                <p class="mb-6" style="color: var(--text-secondary)">バックアップの作成と復元管理</p>
                <button onclick="createBackup()" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    バックアップ作成
                </button>

                <div id="backupList" class="mt-8 text-left hidden">
                    <h3 class="font-semibold mb-4" style="color: var(--text-primary)">バックアップ一覧</h3>
                    <div id="backupItems" class="space-y-2"></div>
                </div>
            </div>
        </section>

        <!-- Tab: Audit -->
        <section id="section-audit" class="tab-content hidden">
            <div class="card-static p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold flex items-center gap-3" style="color: var(--text-primary)">
                        <i class="fas fa-history" style="color: var(--success-color)"></i>
                        監査ログ
                    </h2>
                    <button onclick="loadAudit()" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i>
                        更新
                    </button>
                </div>
                <div id="auditLog" class="space-y-2">
                    <p class="text-center py-8" style="color: var(--text-muted)">ログを読み込み中...</p>
                </div>
            </div>
        </section>

        <!-- Tab: Settings -->
        <section id="section-settings" class="tab-content hidden">
            <div class="card-static p-8">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-3" style="color: var(--text-primary)">
                    <i class="fas fa-cog" style="color: var(--accent-color)"></i>
                    システム設定
                </h2>

                <div id="settingsList" class="space-y-4">
                    <!-- Settings loaded here -->
                </div>

                <div class="mt-6 flex justify-end">
                    <button onclick="loadSettings()" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i>
                        設定を再読み込み
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                <p class="text-sm" style="color: var(--text-secondary)">© 2025 賃金台帳 Generator v4.1 PRO</p>
                <div class="flex items-center gap-4 text-sm" style="color: var(--text-muted)">
                    <span class="flex items-center gap-2">
                        <i class="fas fa-bolt text-amber-500"></i>
                        パフォーマンス最適化済み
                    </span>
                    <span class="flex items-center gap-2">
                        <i class="fas fa-check-circle text-green-500"></i>
                        最新版
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ========== THEME TOGGLE ==========
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');

            if (isDark) {
                html.classList.remove('dark');
                html.classList.add('light');
                localStorage.setItem('chingin-color-theme', 'light');
            } else {
                html.classList.remove('light');
                html.classList.add('dark');
                localStorage.setItem('chingin-color-theme', 'dark');
            }
        }

        // ========== TAB NAVIGATION ==========
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));

            // Show selected tab
            document.getElementById('section-' + tabName).classList.remove('hidden');
            document.getElementById('tab-' + tabName).classList.add('active');

            // Load data for specific tabs
            if (tabName === 'data') loadData();
            if (tabName === 'audit') loadAudit();
            if (tabName === 'settings') loadSettings();
            if (tabName === 'backup') loadBackups();
        }

        // ========== FILE UPLOAD ==========
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        async function handleFiles(files) {
            if (!files || files.length === 0) {
                showNotification('ファイルを選択してください', 'error');
                return;
            }

            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const progressTitle = document.getElementById('progressTitle');
            const progressLog = document.getElementById('progressLog');

            // Reset and show progress
            progressBar.style.width = '0%';
            progressBar.className = 'progress-bar';
            progressPercent.textContent = '0%';
            progressTitle.textContent = '処理を開始しています...';
            progressSection.classList.remove('hidden');
            progressLog.classList.remove('hidden');
            progressLog.innerHTML = '';

            const formData = new FormData();
            for (let file of files) {
                formData.append('files', file);
            }

            const addLog = (msg, type = 'info') => {
                const time = new Date().toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
                const icon = type === 'success' ? '✓' : type === 'error' ? '✗' : '→';
                progressLog.innerHTML += `<div class="log-${type}"><span class="log-time">[${time}]</span> ${icon} ${msg}</div>`;
                progressLog.scrollTop = progressLog.scrollHeight;
            };

            addLog('ファイル処理を開始します...', 'info');

            try {
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    if (progress < 90) {
                        progress += Math.random() * 15;
                        progressBar.style.width = Math.min(progress, 90) + '%';
                        progressPercent.textContent = Math.min(Math.round(progress), 90) + '%';
                    }
                }, 200);

                const response = await fetch('/api/upload', { method: 'POST', body: formData });
                const data = await response.json();

                clearInterval(progressInterval);

                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                // Success
                progressBar.style.width = '100%';
                progressBar.classList.add('success');
                progressPercent.textContent = '100%';
                progressTitle.textContent = '処理が完了しました';

                addLog('すべてのファイルを処理しました', 'success');

                // Show file list
                document.getElementById('fileList').classList.remove('hidden');
                const fileItems = document.getElementById('fileItems');
                fileItems.innerHTML = data.results.map(r => `
                    <div class="flex items-center justify-between p-4 rounded-xl" style="background-color: var(--bg-tertiary)">
                        <span class="font-medium" style="color: var(--text-primary)">${r.filename}</span>
                        <span class="flex items-center gap-2 ${r.status === 'success' ? 'text-green-600' : 'text-red-600'}">
                            <i class="fas ${r.status === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                            ${r.status === 'success' ? r.records + ' 件' : (r.message || 'エラー')}
                        </span>
                    </div>
                `).join('');

                loadStats();
                showNotification(`${data.results.filter(r => r.status === 'success').length} 件のファイルを処理しました`, 'success');

            } catch (error) {
                console.error('Error:', error);
                progressBar.classList.add('error');
                progressTitle.textContent = 'エラーが発生しました';
                progressPercent.textContent = 'エラー';
                addLog(`エラー: ${error.message}`, 'error');
                showNotification('ファイル処理中にエラーが発生しました', 'error');
            }
        }

        // ========== NOTIFICATIONS ==========
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;

            const icon = type === 'success' ? 'fa-check-circle' :
                         type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';

            notification.innerHTML = `<i class="fas ${icon}"></i><span>${message}</span>`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ========== LOAD STATS ==========
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                document.getElementById('statEmployees').textContent = stats.total_employees || 0;
                document.getElementById('statRecords').textContent = stats.total_payroll_records || 0;
                document.getElementById('statPeriods').textContent = stats.total_periods || 0;
                document.getElementById('statNetPay').textContent = '¥' + (stats.total_net_pay || 0).toLocaleString();
                document.getElementById('recordCount').textContent = (stats.total_payroll_records || 0) + ' 件';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // ========== LOAD DATA ==========
        async function loadData() {
            try {
                const response = await fetch('/api/data');
                const data = await response.json();

                const tbody = document.getElementById('dataTable');
                if (data.records && data.records.length > 0) {
                    tbody.innerHTML = data.records.map(r => `
                        <tr>
                            <td>${r.employee_id || '-'}</td>
                            <td>${r.name_jp || r.name_roman || '-'}</td>
                            <td>${r.period || '-'}</td>
                            <td class="text-right font-medium">¥${(r.total_pay || 0).toLocaleString()}</td>
                            <td class="text-right">¥${(r.deduction_total || 0).toLocaleString()}</td>
                            <td class="text-right font-bold">¥${(r.net_pay || 0).toLocaleString()}</td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8" style="color: var(--text-muted)">データがありません</td></tr>';
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('データの読み込み中にエラーが発生しました', 'error');
            }
        }

        // ========== EXPORT FUNCTIONS ==========
        function exportAll() {
            showNotification('ALL出力をダウンロード中...', 'info');
            window.location.href = '/api/export/all';
        }

        function exportMonthly() {
            showNotification('月別データをダウンロード中...', 'info');
            window.location.href = '/api/export/monthly';
        }

        function exportChingin() {
            showNotification('賃金台帳をダウンロード中...', 'info');
            window.location.href = '/api/export/chingin';
        }

        // ========== EMPLOYEE SEARCH ==========
        async function searchEmployee() {
            const employeeId = document.getElementById('employeeIdInput').value.trim();
            if (!employeeId) {
                showNotification('従業員IDを入力してください', 'error');
                return;
            }

            try {
                const response = await fetch(`/api/employee/${employeeId}`);
                const data = await response.json();

                if (data.found) {
                    document.getElementById('empName').textContent = data.name_roman || data.name_jp || '-';
                    document.getElementById('empId').textContent = `ID: ${data.employee_id}`;
                    document.getElementById('empDispatch').textContent = data.dispatch || '-';
                    document.getElementById('empRecords').textContent = data.records || 0;
                    document.getElementById('empPeriods').textContent = data.periods ? data.periods.slice(0, 3).join(', ') : '-';
                    document.getElementById('empKana').textContent = data.name_jp || '-';
                    document.getElementById('empRoman').textContent = data.name_roman || '-';

                    document.getElementById('employeeResult').classList.remove('hidden');
                    document.getElementById('employeeNotFound').classList.add('hidden');
                    showNotification('従業員が見つかりました', 'success');
                } else {
                    document.getElementById('employeeNotFound').classList.remove('hidden');
                    document.getElementById('employeeResult').classList.add('hidden');
                    showNotification('従業員が見つかりません', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('検索中にエラーが発生しました', 'error');
            }
        }

        function generateChingin() {
            const employeeId = document.getElementById('employeeIdInput').value.trim();
            if (!employeeId) {
                showNotification('まず従業員を検索してください', 'error');
                return;
            }
            const year = document.getElementById('yearSelect').value;
            showNotification('賃金台帳を生成中...', 'info');
            window.location.href = `/api/employee/${employeeId}/chingin?year=${year}`;
        }

        function previewChingin() {
            const employeeId = document.getElementById('employeeIdInput').value.trim();
            if (!employeeId) {
                showNotification('まず従業員を検索してください', 'error');
                return;
            }
            showNotification('プレビューを読み込み中...', 'info');
        }

        // ========== CLEAR DATA ==========
        async function clearAllData() {
            if (confirm('本当にすべてのデータを削除してもよろしいですか？この操作は取り消せません。')) {
                try {
                    const response = await fetch('/api/clear-all', { method: 'POST' });
                    const data = await response.json();
                    showNotification('すべてのデータを削除しました', 'success');
                    loadStats();
                    loadData();
                } catch (error) {
                    console.error('Error:', error);
                    showNotification('データの削除中にエラーが発生しました', 'error');
                }
            }
        }

        // ========== BACKUP FUNCTIONS ==========
        async function createBackup() {
            try {
                showNotification('バックアップを作成中...', 'info');
                const response = await fetch('/api/backup', { method: 'POST' });
                const data = await response.json();
                showNotification('バックアップを作成しました', 'success');
                loadBackups();
            } catch (error) {
                console.error('Error:', error);
                showNotification('バックアップの作成中にエラーが発生しました', 'error');
            }
        }

        async function loadBackups() {
            try {
                const response = await fetch('/api/backups');
                const backups = await response.json();

                if (backups && backups.length > 0) {
                    document.getElementById('backupList').classList.remove('hidden');
                    document.getElementById('backupItems').innerHTML = backups.map(b => `
                        <div class="flex items-center justify-between p-4 rounded-xl" style="background-color: var(--bg-tertiary)">
                            <div>
                                <p class="font-medium" style="color: var(--text-primary)">${b.filename}</p>
                                <p class="text-sm" style="color: var(--text-muted)">${b.created_at || '-'}</p>
                            </div>
                            <span class="badge ${b.is_valid ? 'badge-success' : 'badge-warning'}">
                                ${b.is_valid ? '有効' : '未検証'}
                            </span>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading backups:', error);
            }
        }

        // ========== AUDIT LOG ==========
        async function loadAudit() {
            try {
                const response = await fetch('/api/audit?limit=50');
                const logs = await response.json();

                const auditLog = document.getElementById('auditLog');
                if (logs && logs.length > 0) {
                    auditLog.innerHTML = logs.map(log => `
                        <div class="p-4 rounded-xl" style="background-color: var(--bg-tertiary)">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium" style="color: var(--text-primary)">${log.action}</span>
                                <span class="text-sm" style="color: var(--text-muted)">${log.created_at || '-'}</span>
                            </div>
                            <p class="text-sm" style="color: var(--text-secondary)">${log.details || '-'}</p>
                        </div>
                    `).join('');
                } else {
                    auditLog.innerHTML = '<p class="text-center py-8" style="color: var(--text-muted)">ログがありません</p>';
                }
            } catch (error) {
                console.error('Error loading audit:', error);
                showNotification('監査ログの読み込み中にエラーが発生しました', 'error');
            }
        }

        // ========== SETTINGS ==========
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                const settings = await response.json();

                const settingsList = document.getElementById('settingsList');
                settingsList.innerHTML = Object.entries(settings).map(([key, data]) => `
                    <div class="p-4 rounded-xl" style="background-color: var(--bg-tertiary)">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                            <div class="flex-1">
                                <p class="font-semibold mb-1" style="color: var(--text-primary)">${key}</p>
                                <p class="text-sm" style="color: var(--text-secondary)">${data.description || '説明なし'}</p>
                            </div>
                            <input type="text" value="${data.value}"
                                   onchange="updateSetting('${key}', this.value)"
                                   class="form-input w-full sm:w-48">
                        </div>
                    </div>
                `).join('');

                showNotification('設定を読み込みました', 'success');
            } catch (error) {
                console.error('Error loading settings:', error);
                showNotification('設定の読み込み中にエラーが発生しました', 'error');
            }
        }

        async function updateSetting(key, value) {
            try {
                await fetch(`/api/settings/${key}?value=${encodeURIComponent(value)}`, { method: 'POST' });
                showNotification(`設定「${key}」を更新しました`, 'success');
            } catch (error) {
                console.error('Error updating setting:', error);
                showNotification('設定の更新中にエラーが発生しました', 'error');
            }
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            showNotification('賃金台帳 Generator v4.1 PRO 準備完了', 'success');
        });
    </script>
</body>
</html>
